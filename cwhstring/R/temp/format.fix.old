"format.fix.old" <- function(x,after,before=2) {  # 2001.03.01, C.Hoffmann
  maxA  <- 1.0e8
  after <- max(after,0)
  withdot <- after>0  #
  toobig <- ifelse(is.na(x),TRUE,abs(x)>=maxA)
  placesbefore <- ifelse(is.na(x),2,pmax(trunc(log10(abs(x))*(1+.Machine$double.eps)),0)+2)
  prinr("1;placesbefore")
  placesbefore[toobig] <- 0
  xx     <- round(abs(x)*10^after)  #  treat as integer
  before <- max(before,placesbefore)
  prinr("before")
  len <- before+after+1
  if (!withdot) str <- matrix(" ",len-1,length(x))
  else str <- matrix(" ",len,length(x))
  if (!all(toobig)) {
    kk <- 1
    while (kk <= after) {
      str[len-kk+1,!toobig] <- xx[!toobig] %% 10
      xx[!toobig] <- xx[!toobig] %/% 10
      kk <- kk+1
    }
    if (withdot) str[len-kk+1,!toobig] <- "."
    while (max(xx[!toobig]) > 0 | kk == after+1) { # latter for leading 0
      str[len-kk,!toobig] <- ifelse(xx[!toobig] > 0 | kk == after+1,xx[!toobig] %% 10,str[len-kk,!toobig])
      xx[!toobig] <- xx[!toobig] %/% 10
      kk <- kk+1
    }
    str[cbind(len-after-placesbefore,seq(ncol(str)))] <- ifelse (x>=0," ","-")
    str <- apply(str,2,paste,collapse="")
  }
  res <- ifelse (toobig,format(x,digits=after+1),str)
  names(res) <- names(x)
  res
}

